<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Main Page</title>
</head>
<body>
  <div class="container">
    <h1><a href="/">Main Page</a></h1>
    {{ if .user }}
    <h5>hello, {{ .user.Login }}</h5>
    <div class="nav">
        <a href="/logout">logout</a>
        <a href="/createPost">Create Post</a>
    </div>  
    {{ else }}
      <a>register</a>|
      <a>login</a>
    {{ end }}

    <!-- Фильтрация и сортировка -->
    <div style="margin-top: 20px;">
        <label for="author">Автор:</label>
        <input type="text" id="author" placeholder="Введите автора">
        <button onclick="applyFilters()">Фильтровать</button>
    </div>

    <div>
        <label for="sortDate">Сортировать по дате:</label>
        <select id="sortDate">
            <option value="ASC">По возрастанию</option>
            <option value="DESC">По убыванию</option>
        </select>
        <button onclick="applyFilters()">Применить сортировку</button>
    </div>



    <div id="posts"></div>
    <div>
      <button onclick="changePage(1)">More.</button>
      
  </div>
    <script>
        let currentPage = 1;
        let currentAuthor = '';
        let currentSort = 'ASC';

        // Функция для отправки GET-запроса с параметрами
        function fetchPosts() {
            var url = `/getPost?`
            if (currentAuthor !== '') {
              url = url + "author=" + currentAuthor
            }

            if ((currentAuthor !== "" || currentPage !== "") && currentSort !== ""){
              url +="&"
            }
            if (currentSort !== ""){
              url = url + "sort=" + currentSort
            }
            if ((currentAuthor !== "" || currentSort !== "") && currentPage !== ""){
              url +="&"
            }
            if (currentPage !== ""){
              url = url + "page=" +currentPage
            }
            // const url = `/getPost?author=${currentAuthor}&sortDate=${currentSort}&page=${currentPage}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    displayPosts(data.posts); // Отображение полученных постов
                })
                .catch(error => console.error('Error fetching posts:', error));
        }

        // Функция для отображения постов
        function displayPosts(posts) {
            const postsDiv = document.getElementById('posts');
            

            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.innerHTML = `<p>${post.content}</p><p>Автор: ${post.author}</p><p>Дата: ${post.created_at}</p>`;
                postsDiv.appendChild(postElement);
            });
        }

        // Применение фильтров и сортировки
        function applyFilters() {
            currentAuthor = document.getElementById('author').value; // Получаем значение фильтра автора
            currentSort = document.getElementById('sortDate').value; // Получаем значение сортировки
            fetchPosts(); // Загружаем посты с новыми параметрами
        }

        // Функция для смены страницы пагинации
        function changePage(page) {
            currentPage = page;
            fetchPosts(); // Загружаем посты для новой страницы
        }

        // Инициализация страницы с начальными параметрами
        fetchPosts();
    </script>
</body>
</html>
